---
title: 单片机加密
date: 2016-02-14 
tags: mcu
---

首先对`S19`(freescale单片机执行文件)文件中关键代码进行PC1（对称加密算法），得到十六进制形式的txt文件。密钥定为16字节，基于速度和安全级别的考虑。了解算法之后可以改变字节数，但必须是2的次方。得到文件通过串口传输到单片机上，进行程序解密，编程，引导。


<!-- more -->

加密文件的特性：1，任意改变一位则解密不出原文；2，密钥可以半路变化。

加密后的格式：
`长度减一（明码）+ 编码地址（加密）+ 编程数据（加密）+ 全部数据的校验（明码）`


## 对称加密算法总结：

优点：算法公开，计算量小，加密速度快，加密效率高。
缺点：安全性较弱，密钥管理负担大，缺乏签名功能。
具体算法：DES算法，3DES算法，TDEA算法，Blowfish算法，RC5算法，IDEA算法。（计算机专网系统中广泛使用DES和IDEA算法）

## 主流加密算法：

* DES算法：64位明文块变为数据长度为64位密文输出块，其中8位为奇偶校验位，另外56位为密码长度。具有极高安全性，可靠加密方法。

* RC算法：将一个256字节的初始数簇进行随机搅乱，得到一个子密钥，将密钥和明文进行异或运算，得到密文。RC4是目前最安全的加密算法之一。


## 非对称加密算法：

主要算法：RSA，Elgamal，背包算法，Rabin，D-H，ECC。使用广泛的是RSA算法。
RSA可以通过认证来防止中间人攻击。
原理：主机和客户端都生成一对密钥，公钥和私钥，分别用来加密和解密，主机用客户端的私钥加密信息发给客户端，客户端用自己的私钥解密，其他人无法解密。
非对称和对称算法之间的区别：密钥值的不同，非对称比对称慢千倍，但安全系数高。

## 单片机加密方法

1. 烧断数据总线。有损坏的风险。
2. 芯片打磨改型，这个方法有一定作用，改了型号能误导，但同时也增加成本，解密者一般也能分析出来。
3. 用不合格的单片机的的存储器。很多单片机有这种情况，有的是小容量改为大容量来用，破解者应很难发现。使用时要测试可靠。
4. 其他还有添加外部硬件电路的加密方法。增加成本，效果不一定好。
5. 软件加密，是一些防止别人读懂程序的方法，单一的这种方法不能防止别人全盘复制。须配合其他的加密方法。
6. 通过序列号加密。在单片机中生成一个唯一的随机长序列号，并加入复杂的特种算法,或加入重新编码的企业信息在里面，每个芯片内不同，复制者只能复制到一个序列号。这个方法不能防止复制，但能发现复制品，并可在升级或在网络状态控制它或让他自毁。如果产品不联机或不可升级，则这个方法完全无效，只能是在上法院时可当作证据，因为内含特种算法破解者是无法知道的。
7. 通过单片机唯一的特性标识（不可修改）进行加密这个方法最好，能很好的防止复制。但大多单片机没有唯一标识。


序列号加密实现方法:

`PC机 <------------> 带自定义算法序列号单片机系统`
控制方法：

1. PC根据传回来的序列号根据算法判断是否合法，合法就运行，不合法处理它。
2. 单片机内部的序列号经加密算法处理，单片机系统同样要防止软件被更改，可在单片机内部加入CRC等数据校验。
3. 序列号传送时可采用双向加密算法认证，相当于银卡的数据交换方式。

## 总结

- 硬件加密与软件加密是分不开的,互相支撑,互相依存的。
- 利用单片机未公开, 未被利用的标志位或单元,作为软件标志位。
- 程序入口地址不要用整地址。
- 在无程序的空单元也加上程序机器码 , 最好要加巧妙一点。
- 用大容量芯片 , 用市场上仿真器不能仿真的芯片。
- 关键数据存放在 EEPROM 中 , 或程序初始化时把密码写到 EEPROM 中 , - 程序执行时再查密码正确与否。
- 把几种不同品种的单片机放在同一设备中。
