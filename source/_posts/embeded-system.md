---
title: 嵌入式系统概述
date: 2015-09-22
tags: mcu
---

嵌入式操作系统是一种支持嵌入式系统应用的操作系统软件，它是嵌入式系统(包括硬、软件系统)极为重要的组成部分，通常包括与硬件相关的底层驱动软件、系统内核、设备驱动接口、通信协议、图形界面、标准化浏览器等Browser。

嵌入式操作系统具有通用操作系统的基本特点，如能够有效管理越来越复杂的系统资源；能够把硬件虚拟化，使得开发人员从繁忙的驱动程序移植和维护中解脱出来；能够提供库函数、驱动程序、工具集以及应用程序 。

<!-- more -->

与通用操作系统相比较，嵌入式操作系统在系统实时高效性、硬件的相关依赖性、软件固态化以及应用的专用性等方面具有较为突出的特点。

### 嵌入式操作系统的种类

一般情况下，嵌入式操作系统可以分为两类：

一类是面向控制、通信等领域的实时操作系统，如WindRiver公司的VxWorks、ISI的pSOS、QNX系统软件公司的QNX、ATI的Nucleus等；

另一类是面向消费电子产品的非实时操作系统，这类产品包括个人数字助理(PDA)、移动电话、机顶盒、电子书、WebPhone等。

**非实时操作系统**

早期的嵌入式系统中没有操作系统的概念，程序员编写嵌入式程序通常直接面对裸机及裸设备。在这种情况下，通常把嵌入式程序分成两部分，即前台程序和后台程序。

前台程序通过中段来处理事件，其结构一般为无限循环；后台程序则掌管整个嵌入式系统软、硬件资源的分配、管理以及任务的调度，是一个系统管理调度程序。这就是通常所说的前后台系统。

一般情况下，后台程序也叫任务级程序，前台程序也叫事件处理级程序。在程序运行时，后台程序检查每个任务是否具备运行条件，通过一定的调度算法来完成相应的操作。

对于实时性要求特别严格的操作通常由中断来完成，仅在中断服务程序中标记事件的发生，不再做任何工作就退出中断，经过后台程序的调度，转由前台程序完成事件的处理，这样就不会造成在中断服务程序中处理费时的事件而影响后续和其他中断。

实际上，前后台系统的实时性比预计的要差。这是因为前后台系统认为所有的任务具有相同的优先级别，即是平等的，而且任务的执行又是通过FIFO队列排队，因而对那些实时性要求高的任务不可能立刻得到处理。

另外，由于前台程序是一个无限循环的结构，一旦在这个循环体中正在处理的任务崩溃，使得整个任务队列中的其他任务得不到机会被处理，从而造成整个系统的崩溃。由于这类系统结构简单，几乎不需要RAM/ROM的额外开销，因而在简单的嵌入式应用被广泛使用。

**实时操作系统**

实时系统是指能在确定的时间内执行其功能并对外部的异步事件做出响应的计算机系统。其操作的正确性不仅依赖于逻辑设计的正确程度，而且与这些操作进行的时间有关。“在确定的时间内”是该定义的核心。也就是说，实时系统是对响应时间有严格要求的。

实时系统对逻辑和时序的要求非常严格，如果逻辑和时序出现偏差将会引起严重后果。实时系统有两种类型：软实时系统和硬实时系统。软实时系统仅要求事件响应是实时的，并不要求限定某一任务必须在多长时间内完成；而在硬实时系统中，不仅要求任务响应要实时，而且要求在规定的时间内完成事件的处理。通常，大多数实时系统是两者的结合。实时应用软件的设计一般比非实时应用软件的设计困难。实时系统的技术关键是如何保证系统的实时性。

实时多任务操作系统是指具有实时性、能支持实时控制系统工作的操作系统。其首要任务是调度一切可利用的资源完成实时控制任务，其次才着眼于提高计算机系统的使用效率，重要特点是要满足对时间的限制和要求。实时操作系统具有如下功能：任务管理(多任务和基于优先级的任务调度)、任务间同步和通信(信号量和邮箱等)、存储器优化管理(含ROM的管理)、实时时钟服务、中断管理服务。实时操作系统具有如下特点：规模小，中断被屏蔽的时间很短，中断处理时间短，任务切换很快。

实时操作系统可分为可抢占型和不可抢占型两类。对于基于优先级的系统而言，可抢占型实时操作系统是指内核可以抢占正在运行任务的CPU使用权并将使用权交给进入就绪态的优先级更高的任务，是内核抢了CPU让别的任务运行。不可抢占型实时操作系统使用某种算法并决定让某个任务运行后，就把CPU的控制权完全交给了该任务，直到它主动将CPU控制权还回来。中断由中断服务程序来处理，可以激活一个休眠态的任务，使之进入就绪态；而这个进入就绪态的任务还不能运行，一直要等到当前运行的任务主动交出CPU的控制权。使用这种实时操作系统的实时性比不使用实时操作系统的系统性能好，其实时性取决于最长任务的执行时间。不可抢占型实时操作系统的缺点也恰恰是这一点，如果最长任务的执行时间不能确定，系统的实时性就不能确定。

可抢占型实时操作系统的实时性好，优先级高的任务只要具备了运行的条件，或者说进入了就绪态，就可以立即运行。也就是说，除了优先级最高的任务，其他任务在运行过程中都可能随时被比它优先级高的任务中断，让后者运行。通过这种方式的任务调度保证了系统的实时性，但是，如果任务之间抢占CPU控制权处理不好，会产生系统崩溃、死机等严重后果。

### 嵌入式操作系统的发展

嵌入式操作系统伴随着嵌入式系统的发展经历了4个比较明显的阶段。

第一阶段是无操作系统的嵌入算法阶段，是以单芯片为核心的可编程控制器形式的系统，同时具有与监测、伺服、指示设备相配合的功能。这种系统大部分应用于一些专业性极强的工业控制系统中，一般没有操作系统的支持，通过汇编语言编程对系统进行直接控制，运行结束后清除内存。这一阶段系统的主要特点是：系统结构和功能都相对单一，处理效率较低，存储容量较小，几乎没有用户接口。由于这种嵌入式系统使用简便、价格很低，以前在国内工业领域应用较为普遍，但是已经远远不能适应高效的、需要大容量存储介质的现代化工业控制和新兴的信息家电等领域的需求。

第二阶段是以嵌入式CPU为基础、以简单操作系统为核心的嵌入式系统。这一阶段系统的主要特点是：CPU种类繁多，通用性比较差；系统开销小， 效率高；一般配备系统仿真器，操作系统具有一定的兼容性和扩展性；应用软件较专业，用户界面不够友好；系统主要用来控制系统负载以及监控应用程序运行。

第三阶段是通用的嵌入式实时操作系统阶段，是以嵌入式操作系统为核心的嵌入式系统。这一阶段系统的主要特点是：嵌入式操作系统能运行于各种不同类型的微处理器上，兼容性好；操作系统内核精小、效率高，并且具有高度的模块化和扩展性；具备文件和目录管理、设备支持、多任务、网络支持、图形窗口以及用户界面等功能；具有大量的应用程序接口(API)，开发应用程序简单；嵌入式应用软件丰富。

第四阶段是以基于Internet为标志的嵌入式系统，这是一个正在迅速发展的阶段。目前大多数嵌入式系统还孤立于Internet之外，但随着Internet的发展以及Internet技术与信息家电、工业控制技术等结合日益密切，嵌入式设备与Internet的结合将代表着嵌入式技术的真正未来。

### 使用实时操作系统的必要性

嵌入式实时操作系统在目前的嵌入式应用中用得越来越广泛，尤其在功能复杂、系统庞大的应用中显得愈来愈重要。

首先，嵌入式实时操作系统提高了系统的可靠性。在控制系统中，出于安全方面的考虑，要求系统起码不能崩溃，而且还要有自愈能力。不仅要求在硬件设计方面提高系统的可靠性和抗干扰性，而且也应在软件设计方面提高系统的抗干扰性，尽可能地减少安全漏洞和不可靠的隐患。长期以来的前后台系统软件设计在遇到强干扰时，使得运行的程序产生异常、出错、跑飞，甚至死循环，造成了系统的崩溃。而实时操作系统管理的系统，这种干扰可能只是引起若干进程中的一个被破坏，可以通过系统运行的系统监控进程对其进行修复。通常情况下，这个系统监视进程用来监视各进程运行状况，遇到异常情况时采取一些利于系统稳定可靠的措施，如把有问题的任务清除掉。

其次，提高了开发效率，缩短了开发周期。在嵌入式实时操作系统环境下，开发一个复杂的应用程序，通常可以按照软件工程中的解耦原则将整个程序分解为多个任务模块。每个任务模块的调试、修改几乎不影响其他模块。商业软件一般都提供了良好的多任务调试环境。

再次，嵌入式实时操作系统充分发挥了32位CPU的多任务潜力。32位CPU比8、16位CPU快，另外它本来是为运行多用户、多任务操作系统而设计的，特别适于运行多任务实时系统。32位CPU采用利于提高系统可靠性和稳定性的设计，使其更容易做到不崩溃。

例如， CPU运行状态分为系统态和用户态。将系统堆栈和用户堆栈分开，以及实时地给出CPU的运行状态等，允许用户在系统设计中从硬件和软件两方面对实时内核的运行实施保护。如果还是采用以前的前后台方式，则无法发挥32位CPU的优势。从某种意义上说，没有操作系统的计算机(裸机)是没有用的。在嵌入式应用中，只有把CPU嵌入到系统中，同时又把操作系统嵌入进去，才是真正的计算机嵌入式应用。


### 实时操作系统的优缺点

在嵌入式实时操作系统环境下开发实时应用程序使程序的设计和扩展变得容易，不需要大的改动就可以增加新的功能。通过将应用程序分割成若干独立的任务模块，使应用程序的设计过程大为简化；而且对实时性要求苛刻的事件都得到了快速、可靠的处理。通过有效的系统服务，嵌入式实时操作系统使得系统资源得到更好的利用。但是，使用嵌入式实时操作系统还需要额外的ROM/RAM开销，2~5%的CPU额外负荷，以及内核的费用。
    
    
## 主流嵌入式处理器介绍

`嵌入式微处理器(Embedded Microprocessor Unit, EMPU)`

嵌入式微处理器采用“增强型”通用微处理器。由于嵌入式系统通常应用于环境比较恶劣的环境中，因而嵌入式微处理器在工作温度、电磁兼容性以及可靠性方面的要求较通用的标准微处理器高。但是，嵌入式微处理器在功能方面与标准的微处理器基本上是一样的。

根据实际嵌入式应用要求，将嵌入式微处理器装配在专门设计的主板上，只保留和嵌入式应用有关的主板功能，这样可以大幅度减小系统的体积和功耗。和工业控制计算机相比，嵌入式微处理器组成的系统具有体积小、重量轻、成本低、可靠性高的优点，但在其电路板上必须包括ROM、RAM、总线接口、各种外设等器件，从而降低了系统的可靠性，技术保密性也较差。

由嵌入式微处理器及其存储器、总线、外设等安装在一块电路主板上构成一个通常所说的单板机系统。嵌入式处理器目前主要有Am186/88、386EX、SC-400、Power PC、68000、MIPS、ARM系列等。

`嵌入式微控制器(Microcontroller Unit, MCU)`

嵌入式微控制器又称单片机，它将整个计算机系统集成到一块芯片中。嵌入式微控制器一般以某种微处理器内核为核心，根据某些典型的应用，在芯片内部集成了ROM/EPROM、RAM、总线、总线逻辑、定时/计数器、看门狗、I/O、串行口、脉宽调制输出、A/D、D/A、Flash RAM、EEPROM等各种必要功能部件和外设。

为适应不同的应用需求，对功能的设置和外设的配置进行必要的修改和裁减定制，使得一个系列的单片机具有多种衍生产品，每种衍生产品的处理器内核都相同，不同的是存储器和外设的配置及功能的设置。这样可以使单片机最大限度地和应用需求相匹配，从而减少整个系统的功耗和成本。和嵌入式微处理器相比，微控制器的单片化使应用系统的体积大大减小，从而使功耗和成本大幅度下降、可靠性提高。由于嵌入式微控制器目前在产品的品种和数量上是所有种类嵌入式处理器中最多的，而且上述诸多优点决定了微控制器是嵌入式系统应用的主流。

微控制器的片上外设资源一般比较丰富，适合于控制，因此称为微控制器。通常，嵌入式微处理器可分为通用和半通用两类，比较有代表性的通用系列包括8051、P51XA、MCS-251、MCS-96/196/296、C166/167、68300等。而比较有代表性的半通用系列，如支持USB接口的MCU 8XC930/931、C540、C541；支持I2C、CAN总线、LCD等的众多专用MCU和兼容系列。目前MCU约占嵌入式系统市场份额的70%。

`嵌入式DSP处理器(Embedded Digital Signal Processor, EDSP)`

在数字信号处理应用中，各种数字信号处理算法相当复杂，这些算法的复杂度可能是O(nm)的，甚至是NP的，一般结构的处理器无法实时的完成这些运算。由于DSP处理器对系统结构和指令进行了特殊设计，使其适合于实时地进行数字信号处理。在数字滤波、FFT、谱分析等方面，DSP算法正大量进入嵌入式领域，DSP应用正从在通用单片机中以普通指令实现DSP功能，过渡到采用嵌入式`DSP`处理器。

嵌入式`DSP`处理器有两类：

* `DSP` 处理器经过单片化、EMC改造、增加片上外设成为嵌入式DSP处理器，`TI` 的 `TMS320C2000/C5000` 等属于此范畴；

* 在通用单片机或SOC中增加`DSP`协处理器，例如`Intel`的 MCS-296 和 `Infineon(Siemens)`的` TriCore`。

另外，在有关智能方面的应用中，也需要嵌入式DPS处理器，例如各种带有智能逻辑的消费类产品，生物信息识别终端，带有加解密算法的键盘，ADSL接入、实时语音压解系统，虚拟现实显示等。这类智能化算法一般都是运算量较大，特别是向量运算、指针线性寻址等较多，而这些正是DSP处理器的优势所在。

嵌入式DSP处理器比较有代表性的产品是TI的TMS320系列和Motorola的DSP56000系列。TMS320系列处理器包括用于控制的C2000系列、移动通信的C5000系列，以及性能更高的C6000和C8000系列。DSP56000目前已经发展成为DSP56000、DSP56100、DSP56200和DSP56300等几个不同系列的处理器。另外，Philips公司最近也推出了基于可重置嵌入式DSP结构，采用低成本、低功耗技术制造的R. E. A. L DSP处理器，其特点是具备双Harvard结构和双乘/累加单元，应用目标是大批量消费类产品。

`嵌入式片上系统(System On Chip, SOC)`

随着EDI的推广和VLSI设计的普及化，以及半导体工艺的迅速发展，可以在一块硅片上实现一个更为复杂的系统，这就产生了SOC技术。

各种通用处理器内核将作为SOC设计公司的标准库，和其他许多嵌入式系统外设一样，成为VLSI设计中一种标准的器件，用标准的VHDL、Verlog等硬件语言描述，存储在器件库中。用户只需定义出其整个应用系统，仿真通过后就可以将设计图交给半导体工厂制作样品。这样除某些无法集成的器件以外，整个嵌入式系统大部分均可集成到一块或几块芯片中去，应用系统电路板将变得很简单，对于减小整个应用系统体积和功耗、提高可靠性非常有利。SOC可分为通用和专用两类，通用SOC如Infineon(Siemens)的TriCore、Motorola的M-Core，以及某些ARM系列器件，如Echelon和Motorola联合研制的Neuron芯片等；专用SOC一般专用于某个或某类系统中，如Philips的Smart XA，它将XA单片机内核和支持超过2048位复杂RSA算法的CCU单元制作在一块硅片上，形成一个可加载Java或C语言的专用SOC，可用于互联网安全方面。

    




